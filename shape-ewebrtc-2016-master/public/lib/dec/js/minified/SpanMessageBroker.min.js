var connectionType="span",properties=getProperties();
function RunSpanMessageBroker(){if("WebSocket"in window){console.log("WebSocket is supported by your Browser!");var f=new WebSocket("ws://"+properties.host+":"+properties.port+"/");f.onopen=function(){console.log("Web Scoket is connected now");var a=new DecSuccess("0","Successfully intialized the components and connected to span server"),b=drive.callback;null!=b&&b(a)};f.onmessage=function(a){console.log("Received request from Span Server in onmessage method()");a=a.data;console.log("Received msg from span is ::: "+
a);console.log("index of letrequest is::"+a.indexOf("dec.LetRequest"));if(-1!=a.indexOf("dec.LetRequest")){a=JSON.parse(a)["dec.LetRequest"];decodedData=decodeURIComponent(a.request.data);console.log("DecodedData::::"+decodedData);var b=JSON.parse(decodedData),e=b.component,c=b.nameSpace;a=b.value;var k=b.options,g=b.method,b=b.eventType;console.log("component is:::: "+e);console.log("namespace is:::: "+c);console.log("value is:::: "+a);console.log("options is:::: "+k);console.log("method is:::: "+
g);console.log("eventType is:::: "+b);var h="",h=null==c||0==c.length?e:e+"."+c,d=getCurrentObject(e,c);if(null!=d)if(null!=g&&"clear"===g)e=k||null,console.log("Received Delete method call for NodeLevel \x3d "+h+", leaf \x3d "+d.isLeaf()),c=null,c=e?handleDeleteWithOptions(h,k,d.isLeaf(),d.isArray,d.isMap):handleDeleteWithNoOptions(h,d.isLeaf(),d.isArray,d.isMap),console.log("Deleted Item ::: ",c),null==a&&(a=c);else if(d.isArray&&null!=a)console.log("Received component is of Array Type"),setItemsOfArrayType(h,
a,k);else for(attrKey in console.log("Received component is of non Array Type"),a){attrVal=a[attrKey];console.log("ATTRIBUTE KEY::  "+attrKey);console.log("ATTRIBUTE VALUE::  "+attrVal);var g="",g=null==c||""==c?attrKey:c+"."+attrKey,f=getCurrentObject(e,g);null!=f?f.isArray?setItemsOfArrayType(h+"."+attrKey,attrVal,k):setItemsOfLeafOrNonLeafType(d,attrKey,attrVal):console.log("Unable to get the current object for "+e+"."+g)}executeSubscriptionCallbackForParentChild(h,a,b)}else console.log("Received Set dec request..ignoring...")};
f.onclose=function(){console.log("Connection is closed...")};f.onerror=function(a){console.log("websocket connection to host "+properties.host+" port "+properties.port+" failed");console.log("error is::"+a);a=new DecError(DecErrorCodes.span_not_found.errorcode,DecErrorCodes.span_not_found.errormessage);var b=drive.callback;null!=b&&eval("("+b+")").call(null,a)}}else console.log("WebSocket NOT supported by your Browser!")};