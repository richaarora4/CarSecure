var appIDList=[],Availability={available:0,readonly:1,not_supported:2,not_supported_yet:3,not_supported_security:4,not_supported_policy:5,not_supported_other:6},DecErrorCodes={invalid_parameter:{errorcode:"invalid_parameter",errormessage:"Invalid parameter"},not_authenticated:{errorcode:"not_authenticated",errormessage:"Not authenticated"},not_authorized:{errorcode:"not_authorized",errormessage:"Not authorized"},connection_timeout:{errorcode:"connection_timeout",errormessage:"Communication error"},
not_subscribed:{errorcode:"not_subscribed",errormessage:"Not subscribed"},not_supported:{errorcode:"not_supported",errormessage:"Not Supported"},component_not_found:{errorcode:"component_not_found",errormessage:"Component not found"},span_not_found:{errorcode:"span_server_not_connected",errormessage:"Not connected to span server, Please check the configuration"}},EventType={ALL:"all",CREATE:"create",ADD:"add",UPDATE:"update",GET:"get",DELETE:"delete"},componentsArray="alertmanager appmanager calendar commerce connectivity identity media navigation notification policy sa search settings sms speech tracking tts vehicleinfo".split(" "),
ws=null,connectionType="span";console.log("Using Connection Type: ",connectionType);
var DecCommon=function(){this.callback=null;this.isMap=!1;this.appId="DECJSSDK";this.setAppId=function(a){this.appId=a};this.getAppId=function(){return this.appId};this.setNodeLevel=function(a){this.nodeLevel=a};this.getNodeLevel=function(){return this.nodeLevel};this.setLeafStatus=function(a){this.leaf=a};this.isLeaf=function(){return this.leaf};this.setAvailableStatus=function(a){this.availableStatus=a};this.getAvailableStatus=function(){return this.availableStatus};this.subscribe=function(a,b){console.log("Processing subscribe functionality");
this.availableStatus=Availability.available;var c=this.nodeLevel;console.log("HANDLE is :::"+c);var d=createSubscriptionHandle(c);console.log("SUBSCRIPTION HANDLE "+d);checkLocalSubscriptions(d,a,b)?console.log("Is already subscribed ::: true"):(console.log("Adding subscriptions"),null!=addLocalSubscriptions(d,a,b)?(console.log("Is already subscribed ::: false"),console.log("Subscription is done"),c={component:getComponent(c),namespace:getNameSpace(c),method:"subscribe",eventType:EventType.GET,value:{}},
console.log("Notifying Systems"),notifySystems(c)):console.log("Is already subscribed ::: true"));return d};this.unsubscribe=function(a){a=a||null;null!=a?(storage[a]=null,a={component:getComponent(a),namespace:getNameSpace(a),method:"unsubscribe",eventType:EventType.DELETE,value:{}},console.log("Notifying Systems on Unsubscribe"),notifySystems(a),console.log("Unsubscribed...")):console.log("Unsubscribe method called without handle")};this.get=function(a){var b=a||null,c="";console.log("Get Called for NodeLevel \x3d "+
this.nodeLevel+", leaf \x3d "+this.isLeaf());if(b)if(this.isLeaf())c=localStorage.getItem(this.nodeLevel);else{var d=Object.keys(localStorage),e=localStorage.getItem(this.nodeLevel),e=JSON.parse(e);if(this.isArray){console.log("JSON: "+a);var b=JSON.stringify(a),f=JSON.parse(b);console.log("json parse"+f);a=[];var h=[],g=0;for(attrKey in f)a[g]=attrKey,h[g]=f[attrKey],g++;for(var k=[],l=f=0;l<e.length;l++){for(var m=!0,b=0;b<g;b++)if(d=h[b],e[l][a[b]]!==d){m=!1;break}m&&(k[f]=JSON.stringify(e[l]),
f++)}console.log("GET Array Result: "+k);return new Promise(function(a,b){a(k)})}if(this.isMap){f=JSON.parse(a);a={};for(b=0;b<f.length;b++)d=f[b],null!==e[d]&&(a[d]=e[d]);c=JSON.stringify(a)}else{c="{";if(b instanceof Array)for(d=e=0;d<b.length;d++)0!==e&&(c+=","),c+="'"+this.nodeLevel+"."+b[d]+"':'"+localStorage.getItem(this.nodeLevel+"."+b[d])+"'",e++;else for(b=e=0;b<d.length;b++)isNaN(parseInt(d[b]))&&-1!=d[b].indexOf(this.nodeLevel)&&(0!==e&&(c+=","),c+=d[b]+":'"+localStorage.getItem(d[b])+
"'",e++);c+="}"}console.log("GET Result: "+c);console.log("GET Result: "+c.length);return new Promise(function(a,b){a(c)})}else c=getValueForHandle(this.isLeaf(),this.isArray,this.isMap,this.nodeLevel);console.log("Retreived JSON: "+c);return new Promise(function(a,b){a(c)})};this.set=function(a,b){var c=b||null;if(null===(a||null))return console.log("Set called without options!"),new Promise(function(a,b){var c=JSON.stringify(DecErrorCodes.invalid_parameter);b(Error(c))});try{console.log("JSON: "+
a);console.log("NodeLevel: "+this.nodeLevel);var d=null,d=null==c?EventType.ADD:EventType.UPDATE;if(!this.isLeaf()||this.isArray||this.isMap)if(this.isArray){console.log("Set called for array types");setItemsOfArrayType(this.nodeLevel,a,c);f=null;if(a instanceof Array)f=a;else{var e=[];e[0]=a;f=e}m={component:getComponent(this.nodeLevel),namespace:getNameSpace(this.nodeLevel),method:"set",eventType:d,value:f,options:c};console.log("Notifying Systems");notifySystems(m)}else if(this.isMap)console.log("Set called at parent level for map type"),
setItemsOfMapType(this.nodelLevel,a,c),m={component:getComponent(this.nodeLevel),namespace:getNameSpace(this.nodeLevel),method:"set",eventType:d,value:a,options:c},console.log("Notifying Systems"),notifySystems(m);else{console.log("Set called at parent level for non-array types");var f=!1,h=JSON.stringify(a),g=JSON.parse(h);console.log("json parse"+g);for(l in g)attrVal=g[l],console.log("ATTRIBUTE KEY::  "+l),console.log("ATTRIBUTE VALUE::  "+attrVal),this[l].isArray?(e=setItemsOfArrayType(this.nodeLevel+
"."+l,attrVal,c),null!=e&&(f=!0)):f=setItemsOfLeafOrNonLeafType(this,l,attrVal);f&&(k=this.nodeLevel,-1==k.indexOf(".")&&(k+="."),m={component:getComponent(k),namespace:getNameSpace(k),method:"set",eventType:d,value:a,options:c},console.log("Notifying Systems"),notifySystems(m))}else{console.log("Set called at leaf level");localStorage.setItem(this.nodeLevel,a);var k=this.nodeLevel,l=k.substring(k.lastIndexOf(".")+1),f={};f[l]=a;var m={component:getComponent(k),namespace:k.substring(k.indexOf(".")+
1,k.lastIndexOf(".")),method:"set",eventType:d,value:f,options:c};console.log("Notifying Systems");notifySystems(m)}}catch(n){return console.log("Exception: "+n.message),new Promise(function(a,b){b(Error("Error: "+n.message))})}return new Promise(function(a,b){a("success")})};this.delete=function(a){a=a||null;console.log("Delete Called for NodeLevel \x3d "+this.nodeLevel+", leaf \x3d "+this.isLeaf());a={component:getComponent(this.nodeLevel),namespace:getNameSpace(this.nodeLevel),method:"clear",eventType:EventType.DELETE,
options:a};console.log("Notifying Systems");notifySystems(a);return new Promise(function(a,c){a("Successfully removed")})}};
function handleDeleteWithOptions(a,b,c,d,e){console.log("Entering handleDeleteWithOptions for nodelevel "+a);var f="";if(!c||d||e){if(d)return handleDeleteOfArrayTypes(a,b);if(e)return handleDeleteOfMapTypes(a,b);console.log("Delete items at the parent level");console.log("JSON: "+b);f=JSON.stringify(b);b=JSON.parse(f);console.log("json parse"+b);for(attrKey in b)if(f=b[attrKey],console.log("ATTRIBUTE KEY::  "+attrKey),console.log("ATTRIBUTE VALUE::  "+f),c=a+"."+attrKey,d=getCurrentObject(getComponent(c),
getNameSpace(c)),null!=d&&d.isArray)return handleDeleteOfArrayTypes(c,f)}else return console.log("Delete items at the leaf level for non array types"),f=getValueForHandle(c,d,e,a),localStorage.removeItem(a),f}
function handleDeleteOfArrayTypes(a,b){console.log("Entering handleDeleteOfArrayTypes for nodelevel "+a);var c=localStorage.getItem(a);if(null!=c){c=JSON.parse(c);console.log("JSON: "+b);var d=JSON.stringify(b),e=JSON.parse(d);console.log("json parse"+e);var d=[],f=[],h=0;for(attrKey in e)d[h]=attrKey,f[h]=e[attrKey],h++;for(var e=[],g=0,k=0;k<c.length;k++)for(var l=0;l<h;l++)c[k][d[l]]===f[l]&&(console.log("Item matches, deleting from the array"),e[g]=c[k],g++,delete c[k]);c=c.filter(function(a){return null!==
a});localStorage.setItem(a,JSON.stringify(c));return e}}function handleDeleteOfMapTypes(a,b){for(var c=localStorage.getItem(a),c=JSON.parse(c),d=JSON.parse(b),e=null,f=0;f<d.length;f++){var h=d[f];null!==c[h]&&(e=c[h],delete c[h])}return e}
function handleDeleteWithNoOptions(a,b,c,d){c=getValueForHandle(b,c,d,a);if(b)console.log("Delete called at leaf level with no options"),localStorage.removeItem(a);else for(console.log("Delete called at parent level with no options"),b=Object.keys(localStorage),d=0;d<b.length;d++)isNaN(parseInt(b[d]))&&-1!=b[d].indexOf(a)&&localStorage.removeItem(b[d]);return c}var Drive=function(){this.policy=null},Storage=function(){},drive=new Drive,storage=new Storage;
function DecError(a,b){this.errorCode=a;this.errorMessage=b;this.getErrorCode=function(){return this.errorCode};this.getErrorMessage=function(){return this.errorMessage}}function DecSuccess(a,b){this.successCode=a;this.successMessage=b;this.getSuccessCode=function(){return this.successCode};this.getSuccessMessage=function(){return this.successMessage}}function contains(a){for(var b=componentsArray.length;b--;)if(componentsArray[b]===a)return!0;return!1}
function checkForComponentsValidity(a){for(var b=0;b<a.length;b++){var c=a[b];if(!contains(c))return c}return null}init=function(a,b,c){console.log("Entering init method");b instanceof Array?initialize(a,b,c):initialize(b,c,a)};
function initialize(a,b,c){console.log("Components passed ::: ",b);if(null==c)throw console.log("Cannot Initialize the component as Application Id is not provided."),"Cannot Initialize the component as Application Id is not provided.";appIDList.push(c);var d=checkForComponentsValidity(b);if(null!=d)console.log("Cannot Initialize... "+d+" is not a valid component"),b=new DecError(DecErrorCodes.component_not_found.errorcode,DecErrorCodes.component_not_found.errormessage),null!=a&&a(b);else{drive.callback=
a;for(d=0;d<b.length;d++){var e=b[d];console.log("Initializing "+e);drive[e]=new DecCommon;drive[e].setLeafStatus(!1);drive[e].setNodeLevel(b[d]);drive[e].setAvailableStatus(Availability.available);null!=c&&drive[e].setAppId(c);var f=eval("("+e+")");initializeComponents(drive[e],f)}"span"==connectionType?(console.log("Connection Type is Span. Initializing Web Socket"),RunSpanMessageBroker()):(console.log("Connection Type is MB bridge"),b=new DecSuccess("0","Successfully Initialized the components"),
null!=a&&a(b))}}function showLocalStorage(){var a="",b="\x3ctable\x3e\x3ctr\x3e\x3cth\x3eName\x3c/th\x3e\x3cth\x3eValue\x3c/th\x3e\x3c/tr\x3e",c=0;console.log("Local Storage length is"+localStorage.length);for(c=0;c<=localStorage.length-1;c++)a=localStorage.key(c),b+="\x3ctr\x3e\x3ctd\x3e"+a+"\x3c/td\x3e\x3ctd\x3e"+localStorage.getItem(a)+"\x3c/td\x3e\x3c/tr\x3e";document.write(b+"\x3c/table\x3e")}var Operation={READ:"read",WRITE:"write",PRIVATE:"private",POLICY:"policy"};
function checkPermissions(a,b,c,d){console.log(a+b+c+d);a+=c;localStorage.setItem(a,d);d=localStorage.getItem(a);console.log("keyid from localstorage"+d);return!0}function getHashCode(a){var b=0;if(0==a.length)return b;for(i=0;i<a.length;i++)char=a.charCodeAt(i),b=(b<<5)-b+char,b&=b;return b}function createHandle(a,b,c,d){d=hashCode(a+c);console.log("callbackIdentyHashCode ::::::::::::: "+d);a=a+b+c+d;console.log("handle ::::::::::::: "+a);return a}
function addLocalSubscriptions(a,b,c){console.log("inside the addLocalSubscriptions method ::::::::::::::::::::::::::::::::::::::::::::");var d={};d.callback=b;d.options=c||null;b=storage[a];null==b||0==b.length?(console.log("SubscriptionArray is empty. Adding an entry"),b=[],b[0]=d):b[b.length]=d;c=b.length;b=uniqBy(b,JSON.stringify);var e=b.length;storage[a]=b;return 1!=c&&c!=e?null:d}
function checkLocalSubscriptions(a,b,c){console.log("Entering checkLocalSubscriptions for handle ::: "+a);a=storage[a];if(null==a||0==a.length)return console.log("Empty array. Exiting checkLocalSubscriptions"),!1;if(""==b.name)return console.log("Anonymous callback function. Exiting checkLocalSubscriptions"),!1;for(c=0;c<a.length;c++){var d=a[c],d=d.callback,d=eval("("+d+")");if(d.name==b.name)return!0;if(""==b.name)return!1;for(c=0;c<a.length;c++)if(d=a[c],d=d.callback,d=eval("("+d+")"),d.name==
b.name)return!0}console.log("Exiting checkLocalSubscriptions");return!1}
function getMatchingSubscriptions(a,b){console.log("Inside getMatchingSubscriptions");var c=storage[a];if(null==c||0==c.length)return null;for(var d=[],e=0,f=0;f<c.length;f++){var h=c[f],g=h.options;if(null==g)console.log("Options is null, adding subscription to the list"),h.value=b,d[e]=h,e++;else{for(key in g);g=g[key];console.log("Options Key ::: "+key);console.log("Options Value ::: "+g);var k=!1;if(b instanceof Array){console.log("value is of Array type");for(var l=[],m=0,n=0;n<b.length;n++){var p=
b[n];for(attrKey in p)if(attrKey==key&&p[attrKey]==g){k=!0;l[m]=p;m++;break}}k&&(h.value=l,d[e]=h,e++,console.log("Match found, Adding subscription to the list "))}else for(attrKey in b)if(attrKey==key&&b[attrKey]==g){h.value=b;d[e]=h;e++;console.log("Match found, Adding subscription to the list... ");break}}}console.log("Exiting getMatchingSubscriptions. Subcriptions List size "+d.length);return d}
function logResult(a){if(a instanceof Array){var b=JSON.parse(JSON.stringify(a)),b=JSON.parse(b[0]);console.log("GET Array Value: "+b)}console.log("Success Result:::"+a)}function logError(a){console.log("Error:::"+a)}function notifySystems(a){"span"==connectionType?(console.log("Connection Type is Span. Notify Span"),notifySpan(a)):(console.log("Connection Type is MB bridge. Notifying DEC Core about changes"),notifyDECCore(a))}
function notifySpan(a){console.log("Notifying Span about change in property value");var b=createDataHandle(a.component,a.namespace),c=a.method,d=getApplicationId(a.component);console.log("senderAppId ::: "+d);"subscribe"==c&&(b=createDataHandleSubscription(a.component,a.namespace,d),console.log("notifySpan Subscription Handle"+b));console.log("datahandle ::: "+b);a=JSON.stringify({component:a.component,nameSpace:a.namespace,handle:b,method:a.method,eventType:a.eventType,value:a.value,options:a.options});
encodedData=encodeURI(a);d={"dec.SetRequest":{sender:{sender:d,receivers:["DECCore"],data:encodedData}}};console.log(JSON.stringify(d));console.log("Sending msg is ::: "+JSON.stringify(d));sendWSMessage(JSON.stringify(d))}function sendWSMessage(a){waitForSocketConnection(ws,1,function(){console.log("message sent!!!");ws.send(a)})}
function waitForSocketConnection(a,b,c){setTimeout(function(){1===a.readyState?(console.log("Web Socket Connection is in READY STATE"),null!=c&&c()):2===a.readyState||3===a.readyState?console.log("Send WS Message failed. Websocket connection is in closing or already in closed state"):(console.log("wait for web socket connection..."),waitForSocketConnection(a,500,c))},b)}function getApplicationId(a){try{if(null!=drive[a])return drive[a].getAppId()}catch(b){}return"DECJSSDK"}
function createSubscriptionHandle(a){return getHashCode(a)+a}function createDataHandle(a,b){return getHashCode(a+"."+b)}function createDataHandleSubscription(a,b,c){return getHashCode(a+"."+b+"."+c)}
function initializeComponents(a,b){for(var c in b){a[c]=new DecCommon;var d=a.getNodeLevel();a[c].setNodeLevel(""+d+"."+c);a[c].getNodeLevel();"java.util.Map"===b[c].type?a[c].isMap=!0:"java.util.List"===b[c].type&&(a[c].isArray=!0);null!=b[c].properties?(a[c].setLeafStatus(!1),initializeComponents(a[c],b[c].properties)):a[c].setLeafStatus(!0)}}
function notifyDECCore(a){console.log("Notifying DEC Core::::"+a);var b=getApplicationId(a.component);console.log("senderAppId ::: "+b);var c=createDataHandle(a.component,a.namespace);"subscribe"==a.method&&(c=createDataHandleSubscription(a.component,a.namespace,b),console.log("NotifyDECCore Subscription Handle"+c));console.log("datahandle ::: "+c);a=JSON.stringify({component:a.component,nameSpace:a.namespace,handle:c,method:a.method,eventType:a.eventType,value:a.value,options:a.options});encodedData=
encodeURI(a);console.log("encodedData::::"+encodedData);sendMessage(b,["DECCore"],encodedData)}
function showLocalStorageForData(){var a="",b="\x3cH3\x3eData Stored in local Storage for components\x3c/H3\x3e\n\x3ctable\x3e\x3ctr\x3e\x3cth\x3eName\x3c/th\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3cth\x3eValue\x3c/th\x3e\x3c/tr\x3e",c=0;console.log("Local Storage length is"+localStorage.length);for(c=0;c<=localStorage.length-1;c++)a=localStorage.key(c),/\d/g.test(a)||(b+="\x3ctr\x3e\x3ctd\x3e"+a+"\x3c/td\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3ctd\x3e"+
localStorage.getItem(a)+"\x3c/td\x3e\x3c/tr\x3e");document.write(b+"\x3c/table\x3e")}
function showLocalStorageForSubscriptions(){var a="",b="\x3cH3\x3eSubscription Details Stored in local Storage for components\x3c/H3\x3e\n\x3ctable\x3e\x3ctr\x3e\x3cth\x3eName\x3c/th\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3cth\x3eValue\x3c/th\x3e\x3c/tr\x3e",c=0;console.log("Local Storage length is"+localStorage.length);for(c=0;c<=localStorage.length-1;c++)a=localStorage.key(c),/\d/g.test(a)&&(b+="\x3ctr\x3e\x3ctd\x3e"+a+"\x3c/td\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3ctd\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3c/td\x3e\x3ctd\x3e"+
localStorage.getItem(a)+"\x3c/td\x3e\x3c/tr\x3e");document.write(b+"\x3c/table\x3e")}function setItemsOfMapType(a,b,c){c=JSON.parse(b);a=[];b=[];var d=0;for(attrKey in c)a[d]=attrKey,b[d]=c[attrKey],d++;c=localStorage.getItem(this.nodeLevel);c=JSON.parse(c);for(d=0;d<a.length;d++)c[a[d]]=b[d];localStorage.setItem(this.nodeLevel,JSON.stringify(c));return c}
function setItemsOfArrayType(a,b,c){console.log("Entering method setItemsOfArrayType");var d=!1,e=JSON.stringify(b),f=JSON.parse(e);console.log("json parse"+f);e=localStorage.getItem(a);e=JSON.parse(e);if(null===e||0===e.length){console.log("Items Array is empty. Initialising and setting the values");e=[];if(b instanceof Array)for(f=e.length,d=0;d<b.length;d++)c=b[d],e[f]=c,f++;else e[0]=b;e=uniqBy(e,JSON.stringify);localStorage.setItem(a,JSON.stringify(e));console.log("Array length "+e.length)}else if(null==
c){console.log("No Filter options. Adding the item to array");if(b instanceof Array)for(f=e.length,d=0;d<b.length;d++)c=b[d],e[f]=c,f++;else e[e.length]=b;e=uniqBy(e,JSON.stringify);localStorage.setItem(a,JSON.stringify(e));console.log("Array length "+e.length)}else{console.log("Filter options present. Updating the Array");c=JSON.stringify(c);b=JSON.parse(c);var h=[];c=[];var g=0;for(filterKey in b)h[g]=filterKey,c[g]=b[filterKey],g++;b=h[0];h=c[0];for(g=0;g<e.length;g++)if(c=e[g],c[b]===h)if(f instanceof
Array)for(var k=0;k<f.length;k++){var l=f[k];for(attrKey in l){var d=attrKey,m=l[attrKey];c[d]=m;e[g]=c;d=!0}}else for(attrKey in f)d=attrKey,m=f[attrKey],c[d]=m,e[g]=c,d=!0;d&&(e=uniqBy(e,JSON.stringify),localStorage.setItem(a,JSON.stringify(e)))}return e}function uniqBy(a,b){var c={};return a.filter(function(a){a=b(a);return c.hasOwnProperty(a)?!1:c[a]=!0})}
function setItemsOfLeafOrNonLeafType(a,b,c){console.log("Entering method setItemsOfLeafOrNonLeafType");var d=!1;if(a[b].isArray)a=a.getNodeLevel()+"."+b,setItemsOfArrayType(a,c,null),d=!0;else if(a[b].isLeaf())localStorage.setItem(a.getNodeLevel()+"."+b,c),d=!0;else for(key in c)newKey=key,newVal=c[key],console.log("ATTRIBUTE KEY::  "+newKey),console.log("ATTRIBUTE VALUE::  "+newVal),d=setItemsOfLeafOrNonLeafType(a[b],newKey,newVal);return d}
function getValueMatchingNodeLevel(a,b,c,d){b=b.substring(0,b.lastIndexOf("."));if(b==a){for(key in c);d[key]=c[key];return d}var e=b.substring(b.lastIndexOf(".")+1);if(null==d[e]){var f={};f[e]=c;return getValueMatchingNodeLevel(a,b,f,d)}for(key in c);d[e][key]=c[key];return d}
function getValueForHandle(a,b,c,d){console.log("Entering getValueForHandle for nodelevel "+d+" And isLeaf "+a);if(a||b)return a=localStorage.getItem(d),console.log("Exiting getValueForHandle for nodelevel "+d),JSON.parse(a);b=Object.keys(localStorage);a={};for(var e=c=0;e<b.length;e++)if(isNaN(parseInt(b[e]))&&-1!=b[e].indexOf(d)){var f={},h=b[e].substring(b[e].lastIndexOf(".")+1);getCurrentObject(getComponent(b[e]),getNameSpace(b[e])).isArray?f[h]=JSON.parse(localStorage.getItem(b[e])):f[h]=localStorage.getItem(b[e]);
a=getValueMatchingNodeLevel(d,b[e],f,a);c++}console.log("Exiting getValueForHandle for nodelevel "+d);return 0==c?null:a}function getComponent(a){return-1!=a.indexOf(".")?a.substring(0,a.indexOf(".")):a}function getNameSpace(a){return-1!=a.indexOf(".")?a.substring(a.indexOf(".")+1):""}
function executeSubscriptionCallbackAfterSet(a,b,c){a=createSubscriptionHandle(a);console.log("subscriptionHandle ::::::::::::::::::::::: "+a);b=getMatchingSubscriptions(a,b);if(null==b||0==b.length)console.log("Component is not subscribed yet. So not sending subscription callback");else for(a=0;a<b.length;a++){var d=b[a];console.log("subscriptionItem::::::::::::::::::: ",d);var e=d.callback,d=d.value;console.log("subValue::::::::::::::::::: ",d);console.log("eventType ::::::::::::::::::: ",c);console.log("Calling subscription callback function");
e(d,c)}}
function executeSubscriptionCallbackForParentChild(a,b,c){console.log("Executing executeSubscriptionCallbackForParentChild for node::::"+a);for(var d=a.split("."),e="",f=b,h=d.length-1;0<=h;h--)if(console.log("Printing Node Value:::"+d[h]),h==d.length-1)executeSubscriptionCallbackAfterSet(a,b,c),e=a;else{var g=e.substring(e.lastIndexOf(".")+1),k={};k[g]=f;e=e.substring(0,e.lastIndexOf("."));console.log("Execute Node :::::::"+e);console.log("NODE value to be sent"+JSON.stringify(k));executeSubscriptionCallbackAfterSet(e,k,
c);f=k}}function getCurrentObject(a,b){var c=drive[a];if(null==c)return null;if(null==b||0==b.length)return c;if(-1==b.indexOf("."))return c[b];for(var d=b.split("."),e=0;e<d.length;e++)c=c[d[e]];return c}var properties=getProperties();
function RunSpanMessageBroker(){"WebSocket"in window?(console.log("WebSocket is supported by your Browser!"),ws=new WebSocket("ws://"+properties.host+":"+properties.port),ws.onopen=function(){console.log("Web Socket is connected now");var a=new DecSuccess("0","Successfully intialized the components and connected to span server"),b=drive.callback;null!=b&&b(a)},ws.onmessage=function(a){console.log("Received request from Span Server in onmessage method()");a=a.data;console.log("Received msg from span is ::: "+
a);console.log("index of letrequest is::"+a.indexOf("dec.LetRequest"));if(-1!=a.indexOf("dec.LetRequest")){a=JSON.parse(a)["dec.LetRequest"];var b=a.request.receivers;console.log("receiversList::::"+b);decodedData=decodeURIComponent(a.request.data);console.log("DecodedData::::"+decodedData);var c=JSON.parse(decodedData),d=c.component,e=c.nameSpace;a=c.value;var f=c.options,h=c.method,c=c.eventType;console.log("component is:::: "+d);console.log("namespace is:::: "+e);console.log("value is:::: "+a);
console.log("options is:::: "+f);console.log("method is:::: "+h);console.log("eventType is:::: "+c);var g=!1;if("subscribe"===h){b=b[0];console.log("receiver :::: "+b);for(var k=0;k<appIDList.length;k++)if(appIDList[k]===b){g=!0;break}console.log("isReceiverAvailable:::: "+g);if(!g)return}b="";b=null==e||0==e.length?d:d+"."+e;g=getCurrentObject(d,e);if(null!=g)if(null!=h&&"clear"===h)d=f||null,console.log("Received Delete method call for NodeLevel \x3d "+b+", leaf \x3d "+g.isLeaf()),e=null,e=d?handleDeleteWithOptions(b,
f,g.isLeaf(),g.isArray,g.isMap):handleDeleteWithNoOptions(b,g.isLeaf(),g.isArray,g.isMap),console.log("Deleted Item ::: ",e),null==a&&(a=e);else if(g.isArray&&null!=a)console.log("Received component is of Array Type"),setItemsOfArrayType(b,a,f);else for(attrKey in console.log("Received component is of non Array Type"),a)attrVal=a[attrKey],console.log("ATTRIBUTE KEY::  "+attrKey),console.log("ATTRIBUTE VALUE::  "+attrVal),h="",h=null==e||""==e?attrKey:e+"."+attrKey,k=getCurrentObject(d,h),null!=k?
k.isArray?setItemsOfArrayType(b+"."+attrKey,attrVal,f):setItemsOfLeafOrNonLeafType(g,attrKey,attrVal):console.log("Unable to get the current object for "+d+"."+h);executeSubscriptionCallbackForParentChild(b,a,c)}else console.log("Received Set dec request..ignoring...")},ws.onclose=function(){console.log("Connection is closed...")},ws.onerror=function(a){console.log("websocket connection to host "+properties.host+" port "+properties.port+" failed");console.log("error is::"+a);a=new DecError(DecErrorCodes.span_not_found.errorcode,
DecErrorCodes.span_not_found.errormessage);var b=drive.callback;null!=b&&eval("("+b+")").call(null,a)}):console.log("WebSocket NOT supported by your Browser!")}"mbbridge"==connectionType&&mb.setReceiveCallback("receiveMessage");function sendMessage(a,b,c){b=JSON.stringify(b);mb.sendMessage(a,b,c)}
function receiveMessage(a,b,c){decodedData=decodeURIComponent(c);console.log("DecodedData::::"+decodedData);c=JSON.parse(decodedData);var d=c.component,e=c.nameSpace;a=c.value;b=c.options;var f=c.method;c=c.eventType;console.log("component is::::"+d);console.log("namespace is::::"+e);console.log("value is:::: "+a);console.log("options is:::: "+b);console.log("method is:::: "+f);console.log("eventType is:::: "+c);var h="",h=null==e||0==e.length?d:d+"."+e,g=getCurrentObject(d,e);if(null!=g)if(null!=
f&&"clear"===f)d=b||null,console.log("Received Delete method call for NodeLevel \x3d "+h+", leaf \x3d "+g.isLeaf()),e=null,e=d?handleDeleteWithOptions(h,b,g.isLeaf(),g.isArray,g.isMap):handleDeleteWithNoOptions(h,g.isLeaf(),g.isArray,g.isMap),console.log("Deleted Item ::: ",e),null==a&&(a=e);else if(g.isArray&&null!=a)console.log("Received component is of Array Type"),setItemsOfArrayType(h,a,b);else for(attrKey in console.log("Received component is of non Array Type"),a){attrVal=a[attrKey];console.log("ATTRIBUTE KEY::  "+
attrKey);console.log("ATTRIBUTE VALUE::  "+attrVal);var f="",f=null==e||""==e?attrKey:e+"."+attrKey,k=getCurrentObject(d,f);null!=k?k.isArray?setItemsOfArrayType(h+"."+attrKey,attrVal,b):setItemsOfLeafOrNonLeafType(g,attrKey,attrVal):console.log("Unable to get the current object for "+d+"."+f)}executeSubscriptionCallbackForParentChild(h,a,c)};